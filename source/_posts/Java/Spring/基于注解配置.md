---
title: 基于注解配置
tags:
  - Java 框架
categories:
  - Java
---

## 概述
注解配置和 xml 配置实现的功能都一样 
都是要降低程序间的耦合。只是配置的形式不一样 
两种配置方式都需要掌握

## 用于创建对象的 

### @Component
作用： 资源让 spring 来管理。相当于在 xml 中配置一个 bean
属性： 
  value：指定 bean 的 id。如果不指定 value ，默认 bean 的 id 是当前类的类名。首字母小写。 

### @Controller @Service @Repository 

这三个注解是针对@Component的衍生注解，作用及属性都是一样的 
**提供了更加明确的语义化**
@Controller：用于表现层的注解。 
@Service：用于业务层的注解。 
@Repository：用于持久层的注解。 
属性： 
  value：指定 bean 的 id。如果不指定 value ，默认 bean 的 id 是当前类的类名。首字母小写

## 用于注入数据的 
相当于：<property name="" ref=""  value=""> 

### @Autowired 
作用： 
自动按照类型注入。当使用注解注入属性时，set 方法可以省略。它只能注入其他 bean 类型。当有多个 
类型匹配时，使用要注入的对象变量名称作为 bean 的 id，在 spring 容器查找，找到了也可以注入成功。找不到 
就报错;如果IOC容器中有多个类型匹配时，报错
出现位置：
可以是成员变量，也可以是方法上。
细节：
在使用注解输入时，set方法可以省略。

### @Qualifier 
作用： 
在自动按照类型注入的基础之上，再按照 Bean 的 id 注入
**给字段注入时，必须和 @Autowire 一起使用；给方法参数注入时，可以独立使用** 
属性： 
value：指定 bean 的 id。 

### @Resource 
作用： 
直接按照 Bean 的 id 注入。它也只能注入其他 bean 类型。 
属性： 
name：指定 bean 的 id。 

### @Value 
作用： 
注入基本数据类型和 String 类型数据的 
属性： 
value：用于指定值 

## 用于改变作用范围的： 
相当于：<bean id="" class="" scope=""> 

### @Scope 
作用： 
指定 bean 的作用范围。 
属性： 
value：指定范围的值 
取值：singleton prototype request session globalsession 

## 和生命周期相关的：(了解) 
相当于：<bean id="" class="" init-method="" destroy-method="" />

### @PostConstruct 
作用： 
用于指定初始化方法。 
### @PreDestroy 
作用： 
用于指定销毁方法。 

## Spring 注解和 XML 的选择问题 
注解的优势： 
配置简单，维护方便（我们找到类，就相当于找到了对应的配置）。 
XML 的优势： 
修改时，不用改源码。不涉及重新编译和部署。 
Spring 管理 Bean 方式的比较


## @Configuration 
作用： 
用于指定当前类是一个 spring 配置类，当创建容器时会从该类上加载注解。获取容器时需要使用 
AnnotationApplicationContext(有@Configuration 注解的类.class)。 
属性： 
value:用于指定配置类的字节码
示例代码： 
``` Java
@Configuration 
public class SpringConfiguration { 
} 
```

## @ComponentScan 
作用： 
用于指定 spring 在初始化容器时要扫描的包。作用和在 spring 的 xml 配置文件中的： 
<context:component-scan base-package="com.doyens"/>是一样的。 
属性： 
basePackages：用于指定要扫描的包。和该注解中的 value 属性作用一样。 
示例代码： 
``` Java
@Configuration 
@ComponentScan("com.doyens") 
public class SpringConfiguration { 
} 
```

## @Bean 
作用： 
该注解只能写在方法上，表明使用此方法创建一个对象，并且放入 spring 容器。 
属性： 
name：给当前@Bean 注解方法创建的对象指定一个名称(即 bean 的 id）。 
示例代码：
``` Java
public class JdbcConfig { 
/** 
* 创建一个数据源，并存入 spring 容器中 
* @return 
*/ 
@Bean(name="dataSource") 
public DataSource createDataSource() { 
try { 
ComboPooledDataSource ds = new ComboPooledDataSource(); 
ds.setUser("root"); 
ds.setPassword("root"); 
ds.setDriverClass("com.mysql.jdbc.Driver"); 
ds.setJdbcUrl("jdbc:mysql:///spring_day02"); 
return ds; 
} catch (Exception e) { 
throw new RuntimeException(e); 
} 
} 
/** 
* 创建一个 DBAssit，并且也存入 spring 容器中 
* @param dataSource 
* @return 
*/ 
@Bean(name="dbAssit") 
public DBAssit createDBAssit(DataSource dataSource) { 
return new DBAssit(dataSource); 
} 
} 
```

## @PropertySource 
作用：  
用于加载.properties 文件中的配置。例如我们配置数据源时，可以把连接数据库的信息写到 
properties 配置文件中，就可以使用此注解指定 properties 配置文件的位置。 
属性： 
value[]：用于指定 properties 文件位置。如果是在类路径下，需要写上 classpath: 
示例代码： 
配置： 
``` Java
public class JdbcConfig { 
@Value("${jdbc.driver}") 
private String driver; 
@Value("${jdbc.url}") 
private String url; 
@Value("${jdbc.username}") 
private String username; 
@Value("${jdbc.password}") 
private String password; 
/** 
* 创建一个数据源，并存入 spring 容器中 
* @return 
*/ 
@Bean(name="dataSource") 
public DataSource createDataSource() { 
try { 
ComboPooledDataSource ds = new ComboPooledDataSource(); 
ds.setDriverClass(driver); 
ds.setJdbcUrl(url); 
ds.setUser(username); 
ds.setPassword(password); 
return ds; 
} catch (Exception e) { 
throw new RuntimeException(e); 
} 
} 
} 
```
jdbc.properties 文件： 
jdbc.driver=com.mysql.jdbc.Driver 
jdbc.url=jdbc:mysql://localhost:3306/db3  
  
jdbc.username=root 
jdbc.password=root 

##  @Import 
作用： 
建立配置类之间的联系
用于导入其他配置类，在引入其他配置类时，可以不用再写@Configuration 注解。当然，写上也没问 
题。 
属性： 
value[]：用于指定其他配置类的字节码。 
示例代码： 
``` Java
@Configuration 
@ComponentScan(basePackages = "com.doyens.spring") 
@Import({ JdbcConfig.class}) 
public class SpringConfiguration { 
} 
@Configuration 
@PropertySource("classpath:jdbc.properties") 
public class JdbcConfig{ 
} 
```
通过注解获取容器： 
ApplicationContext ac = 
new AnnotationConfigApplicationContext(SpringConfiguration.class); 

## Spring 整合 Junit[掌握] 
配置步骤 
- 拷贝整合 junit 的必备 jar 包到 lib 目录 
此处需要注意的是，导入 jar 包时，需要导入一个 spring 中 aop 的 jar 包。  
- 使用@RunWith 注解替换原有运行器 
``` Java
@RunWith(SpringJUnit4ClassRunner.class) 
public class AccountServiceTest { 
} 
```
- 使用@ContextConfiguration 指定 spring 配置文件的位置 
``` Java
@RunWith(SpringJUnit4ClassRunner.class) 
@ContextConfiguration(locations= {"classpath:bean.xml"}) 
public class AccountServiceTest { 
} 
```
**@ContextConfiguration 注解：**
locations 属性：用于指定配置文件的位置。如果是类路径下，需要用 classpath:表明 
classes 属性：用于指定注解的类。当不使用 xml 配置时，需要用此属性指定注解类的位置。 
- 使用@Autowired 给测试类中的变量注入数据 
``` Java
@RunWith(SpringJUnit4ClassRunner.class) 
@ContextConfiguration(locations= {"classpath:bean.xml"}) 
public class AccountServiceTest { 
@Autowired 
private IAccountService as ; 
} 
```
