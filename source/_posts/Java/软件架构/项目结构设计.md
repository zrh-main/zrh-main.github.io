---
title: 项目结构设计
tags:
  - Java面试题
categories:
  软件架构
---

## 分层注意:
- 方便后续代码进行维护扩展
- 分层的效果需要让整个团队都接受
- 各个层职责边界清晰。

## 阿里分层规范
图例:
 ![](unpvc9c2im.jpeg)
开放接口层：
  - 可直接封装 Service 方法暴露成 RPC 接口;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。

终端显示层：
  - 各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。

Web 层：
  - 主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。

Service 层：
  - 相对具体的业务逻辑服务层。

Manager 层：
  - 通用业务处理层(特征)
    1. 对第三方平台封装的层，预处理返回结果及转化异常信息;
    2. 对Service层通用能力的下沉，如缓存方案、中间件通用处理;
    3. 与DAO层交互，对多个DAO的组合复用。

DAO 层：
  - 数据访问层，与底层 MySQL、Oracle、Hbase 进行数据交互

## 优化分层
图例:

从我们的业务开发中总结了一个较为的理想模型,这里要先说明一下由于我们的rpc框架选用的是thrift可能会比其他的一些rpc框架例如dubbo会多出一层,作用和controller层类似

![](cbqtpq30r5.jpeg)
最上层controller和TService是我们阿里分层规范里面的第一层：轻业务逻辑，参数校验，异常兜底。通常这种接口可以轻易更换接口类型，所以业务逻辑必须要轻，甚至不做具体逻辑。

Service：业务层，复用性较低，这里推荐每一个controller方法都得对应一个service,不要把业务编排放在controller中去做，为什么呢？如果我们把业务编排放在controller层去做的话，如果以后我们要接入thrift,我们这里又需要把业务编排在做一次，这样会导致我们每接入一个入口层这个代码都得重新复制一份如下图所示:

![](cb5pa8pq4f.jpeg)
这样大量的重复工作必定会导致我们开发效率下降，所以我们需要把业务编排逻辑都得放进service中去做:
![](xn1isygq3q.jpeg)

Mannager：可复用逻辑层。这里的Mannager可以是单个服务的，比如我们的cache,mq等等，当然也可以是复合的，当你需要调用多个Mannager的时候，这个可以合为一个Mannager，比如逻辑上的连表查询等。如果是httpMannager或rpcMannager需要在这一层做一些数据转换

DAO：数据库访问层。主要负责“操作数据库的某张表，映射到某个java对象”，dao应该只允许自己的Service访问，其他Service要访问我的数据必须通过对应的Service。

## 阿里巴巴编码领域模型规约:
DO（Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。
DTO（Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。
BO（Business Object）：业务对象。由Service层输出的封装业务逻辑的对象。
AO（Application Object）：应用对象。在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。
VO（View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。
Query：数据查询对象，各层接收上层的查询请求。注意超过2个参数的查询封装，禁止使用Map类来传输。

### 折中的方案:

1. 允许Service/Manager可以操作数据领域模型，对于这个层级来说，本来自己做的工作也是做的是业务逻辑处理和数据组装。
2. Controller/TService层的领域模型不允许传入DAO层，这样就不符合职责划分了
3. 同理，不允许DAO层的数据传入到Controller/TService。

![](pa5aby5ysz.png)

## 分层作用
代码是否可复用，是否职责清晰，边界清晰