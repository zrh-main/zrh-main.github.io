---
title: 分类服务器
tags:
  - SpringMVC
categories:
  - Java
---

## 分服务器的目的
在实际开发中，我们会有很多处理不同功能的服务器。例如：
应用服务器：负责部署我们的应用
数据库服务器：运行我们的数据库
缓存和消息服务器：负责处理大并发访问的缓存和消息
文件服务器：负责存储用户上传文件的服务器。
(注意：此处说的不是服务器集群)

1. 准备两个 tomcat 服务器，并创建一个用于存放图片的 web 工程
2. 应用服务器 添加 jar 包
pom.xml
``` xml
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
        <spring.version>5.0.2.RELEASE</spring.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>${spring.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-web</artifactId>
            <version>${spring.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>${spring.version}</version>
        </dependency>


        <dependency>
            <groupId>com.sun.jersey</groupId>
            <artifactId>jersey-client</artifactId>
            <version>1.19.1</version>
        </dependency>

        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.3.2</version>
        </dependency>

    </dependencies>

```
3. 应用服务器 编写控制器实现上传图片
``` Java
@Controller("fileUploadController2")
public class FileUploadController2 {
  public static final String FILESERVERURL =  "http://localhost:9090/day06_spring_image/uploads/";
  /**
  * 文件上传，保存文件到不同服务器
  */
  @RequestMapping("/fileUpload2")
  public String testResponseJson(String picname,MultipartFile uploadFile) throws Exception{
    //定义文件名
    String fileName = "";
    //1.获取原始文件名
    String uploadFileName = uploadFile.getOriginalFilename();
    //2.截取文件扩展名
    String extendName = 
    uploadFileName.substring(uploadFileName.lastIndexOf(".")+1, 
    uploadFileName.length());
    //3.把文件加上随机数，防止文件重复
    String uuid = UUID.randomUUID().toString().replace("-", "").toUpperCase();
    //4.判断是否输入了文件名
    if(!StringUtils.isEmpty(picname)) {
    fileName = uuid+"_"+picname+"."+extendName;
    }else {
    fileName = uuid+"_"+uploadFileName;
    }
    System.out.println(fileName);
    //5.创建 sun 公司提供的 jersey 包中的 Client 对象
    Client client = Client.create();
    //6.指定上传文件的地址，该地址是 web 路径
    WebResource resource = client.resource(FILESERVERURL+fileName);
    //7.实现上传
    String result = resource.put(String.class,uploadFile.getBytes());
    System.out.println(result);
    return "success";
  }
}
```
前端页面
``` html
<form action="fileUpload2" method="post" enctype="multipart/form-data">
名称：<input type="text" name="picname"/><br/>
图片：<input type="file" name="uploadFile"/><br/>
<input type="submit" value="上传"/>
</form>
```
配置解析器
``` xml
<!-- 配置文件上传解析器 -->
<bean id="multipartResolver"
class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
<!-- 设置上传文件的最大尺寸为 5MB -->
<property name="maxUploadSize">
<value>5242880</value>
</property>
</bean>

```