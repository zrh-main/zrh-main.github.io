---
title: 响应数据
tags:
  - SpringMVC
categories:
  - Java
---

## 字符串
controller 方法返回字符串可以指定逻辑视图名，通过视图解析器解析为物理视图地址。
``` Java
//指定逻辑视图名，经过视图解析器解析为 jsp 物理路径：/WEB-INF/pages/success.jsp
@RequestMapping("/testReturnString")
public String testReturnString() {
System.out.println("AccountController 的 testReturnString 方法执行了。。。。");
return "success";
}
```

## void 
在昨天的学习中，我们知道 Servlet 原始 API 可以作为控制器中方法的参数：
``` Java
@RequestMapping("/testReturnVoid")
public void testReturnVoid(HttpServletRequest request,HttpServletResponse response) throws Exception {
}
```
在 controller 方法形参上可以定义 request 和 response，使用 request 或 response 指定响应结果：
1. 使用 request 转发页面，如下：
``` Java
request.getRequestDispatcher("/WEB-INF/pages/success.jsp").forward(request,response);
```
2. 通过 response 页面重定向：
``` Java
response.sendRedirect("testRetrunString")
```
3. 通过 response 指定响应结果，例如响应 json 数据：
``` Java
response.setCharacterEncoding("utf-8");
response.setContentType("application/json;charset=utf-8");
response.getWriter().write("json 串");
```
## ModelAndView 
ModelAndView 是 SpringMVC 为我们提供的一个对象，该对象可以用作控制器方法的返回值。
该对象中有两个方法：
示例代码：
/**
* 返回 ModeAndView
* @return
*/
@RequestMapping("/testReturnModelAndView")
public ModelAndView testReturnModelAndView() {
ModelAndView mv = new ModelAndView();
mv.addObject("username", "张三");
mv.setViewName("success");
return mv;
}
响应的 jsp 代码：
<%@ page language="java" contentType="text/html; charset=UTF-8"
pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>执行成功</title>
</head>
<body>
执行成功！
${requestScope.username}
</body>
</html>
输出结果：
注意：
我们在页面上上获取使用的是 requestScope.username 取的，所以返回 ModelAndView 类型时，浏
览器跳转只能是请求转发。
1.2转发和重定向
1.2.1 forward 转发
controller 方法在提供了 String 类型的返回值之后，默认就是请求转发。我们也可以写成：
/**
* 转发
* @return
*/
@RequestMapping("/testForward")
public String testForward() {
System.out.println("AccountController 的 testForward 方法执行了。。。。");
return "forward:/WEB-INF/pages/success.jsp";
}
需要注意的是，如果用了 formward：则路径必须写成实际视图 url，不能写逻辑视图。
它相当于“request.getRequestDispatcher("url").forward(request,response)”。使用请求
转发，既可以转发到 jsp，也可以转发到其他的控制器方法。
1.2.2 Redirect 重定向
contrller 方法提供了一个 String 类型返回值之后，它需要在返回值里使用:redirect:
/**
* 重定向
* @return
*/
@RequestMapping("/testRedirect")
public String testRedirect() {
System.out.println("AccountController 的 testRedirect 方法执行了。。。。");
return "redirect:testReturnModelAndView";
}
它相当于“response.sendRedirect(url)”。需要注意的是，如果是重定向到 jsp 页面，则 jsp 页面不
能写在 WEB-INF 目录中，否则无法找到。

## @ResponseBody 响应 json 数据
作用：
用于将 Controller 的方法返回的对象，通过 HttpMessageConverter 接口转换为指定格式的数据如：json,xml 等，通过 Response 响应给客户端
注意：
`Springmvc 默认用 MappingJacksonHttpMessageConverter 对 json 数据进行转换，需要加入jackson 的包。jackson2.7.0 以下的版本用不了`

jsp 中的代码：
``` html
<script type="text/javascript">
  $(function(){
    $("#testJson").click(function(){
      $.ajax({
        type:"post",
        url:"${pageContext.request.contextPath}/testResponseJson",
        contentType:"application/json;charset=utf-8",
        data:'{"id":1,"name":"test","money":999.0}',
        dataType:"json",
        success:function(data){
          console.log(data);
        }
      });
    });
  })
</script>
```
控制器中的代码：
``` Java
@Controller("jsonController")
public class JsonController {
    /**
    * 测试响应 json 数据
    */
  @RequestMapping("/testResponseJson")
  public @ResponseBody Account testResponseJson(@RequestBody Account account) {
    System.out.println("异步请求："+account);
    return account;
  }
}
```